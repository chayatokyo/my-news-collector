name: Collect AI News

on:
  schedule:
    # JST 7:00 = UTC 22:00 (å‰æ—¥)
    - cron: "0 22 * * *"
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

permissions:
  contents: write

jobs:
  collect:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: pip install -r requirements.txt

      - name: Run RSS collector
        run: |
          # JSTæ—¥ä»˜ã§å®Ÿè¡Œï¼ˆGitHub Actions ã¯UTCï¼‰
          JST_DATE=$(TZ=Asia/Tokyo date +%Y-%m-%d)
          python scripts/collect_rss.py --config config/ai-news.yaml --date "$JST_DATE"

      - name: Commit and push results
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add output/
          # å¤‰æ›´ãŒã‚ã‚‹å ´åˆã®ã¿ã‚³ãƒŸãƒƒãƒˆ
          if git diff --staged --quiet; then
            echo "No new articles to commit"
          else
            JST_DATE=$(TZ=Asia/Tokyo date +%Y-%m-%d)
            git commit -m "ğŸ“° AI News: ${JST_DATE}"
            git push
          fi
